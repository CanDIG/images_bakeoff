# Copyright (c) 2015-2016, Gregory M. Kurtzer. All rights reserved.
# 
# "Singularity" Copyright (c) 2016, The Regents of the University of California,
# through Lawrence Berkeley National Laboratory (subject to receipt of any
# required approvals from the U.S. Dept. of Energy).  All rights reserved.

BootStrap: debootstrap
OSVersion: xenial
MirrorURL: http://us.archive.ubuntu.com/ubuntu/
Include: bash

%post
    # get needed packages
    apt-get update
    apt-get install -y git openjdk-8-jre libstdc++6

    # get picard from github, including dependency htsjdk
    cd /usr/
    git clone https://github.com/broadinstitute/picard.git 
    cd picard
    git clone https://github.com/samtools/htsjdk.git

    # build picard using gradle
    ./gradlew -g /tmp shadowJar
    mv build/libs/picard.jar picard.jar

    # remove now-unnnecessary files
    rm -rf htsjdk
    rm -rf src
    rm -rf lib
    rm build.xml
    ./gradlew clean
    apt-get autoremove

%runscript
    exec java -jar /usr/picard/picard.jar "$@"
